"use strict";(self.webpackChunkBikeLife=self.webpackChunkBikeLife||[]).push([[123],{2123:(O,p,a)=>{a.r(p),a.d(p,{CarritoModule:()=>y});var s=a(6814),h=a(2296),l=a(2236),C=a(3519),d=a.n(C),t=a(5879),f=a(7104),g=a(638),x=a(137),b=a(9474);const u=function(i){return[i,"ARS","symbol","1.0-0","es-AR"]};function v(i,A){if(1&i){const r=t.EpF();t.TgZ(0,"div",3)(1,"div",10),t._UZ(2,"img",11),t.TgZ(3,"div",6)(4,"p",12),t._uU(5),t._UZ(6,"br"),t._uU(7),t.ALo(8,"currency"),t._uU(9),t._UZ(10,"br"),t._uU(11),t.ALo(12,"currency"),t.qZA(),t.TgZ(13,"button",13),t.NdJ("click",function(){const c=t.CHM(r).$implicit,n=t.oxw();return t.KtG(n.restarCantidad(c))}),t._uU(14,"-"),t.qZA(),t.TgZ(15,"span"),t._uU(16),t.qZA(),t.TgZ(17,"button",13),t.NdJ("click",function(){const c=t.CHM(r).$implicit,n=t.oxw();return t.KtG(n.aumentarCantidad(c))}),t._uU(18,"+"),t.qZA(),t.TgZ(19,"button",14),t.NdJ("click",function(){const c=t.CHM(r).$implicit,n=t.oxw();return t.KtG(n.eliminarProductoDelCarrito(c.Producto.idProducto))}),t._uU(20,"Eliminar"),t.qZA()()()()}if(2&i){const r=A.$implicit;t.xp6(2),t.s9C("src",r.Producto.imagen,t.LSH),t.s9C("alt",r.Producto.nombre),t.xp6(3),t.hij(" ",r.Producto.nombre," "),t.xp6(2),t.hij(" ",t.G7q(8,7,t.VKq(19,u,r.Producto.precio))," "),t.xp6(2),t.hij(" (cantidad: ",r.Cantidad,") "),t.xp6(2),t.hij(" Subtotal: ",t.G7q(12,13,t.VKq(21,u,r.Cantidad*r.Producto.precio))," "),t.xp6(5),t.Oqu(r.Cantidad)}}const P=[{path:"carrito",component:(()=>{class i{constructor(r,o,e,c,n,m){this.database=r,this.cartService=o,this.firestoreService=e,this.carritoService=c,this.servicioRutas=n,this.authService=m,this.productosEnCarrito=[],this.audio=new Audio,this.audio.src="assets/sounds/comprado.mp3",this.audio.load()}ngOnInit(){this.carritoService.cargarCarrito(),this.carritoService.carrito$.subscribe(r=>{this.productosEnCarrito=r}),this.cartService.carrito$.subscribe(r=>{this.productosEnCarrito=r}),this.authService.obtenerEstadoUsuario().subscribe(r=>{this.usuarioActual=r,console.log("Usuario actual:",this.usuarioActual)})}agregarProductoAlCarrito(r){const o=this.productosEnCarrito.find(e=>e.Producto.idProducto===r.idProducto);o?o.Cantidad++:this.productosEnCarrito.push({Producto:r,Cantidad:1}),this.carritoService.actualizarCarrito(this.productosEnCarrito)}aumentarCantidad(r){r.Cantidad++,this.carritoService.actualizarCarrito(this.productosEnCarrito)}restarCantidad(r){r.Cantidad>1&&r.Cantidad--,this.carritoService.actualizarCarrito(this.productosEnCarrito)}calcularTotal(){return this.productosEnCarrito.reduce((r,o)=>r+o.Producto.precio*o.Cantidad,0)}calcularSubtotal(){return this.productosEnCarrito.reduce((r,o)=>r+o.Producto.precio*o.Cantidad,0)}limpiarCarrito(){this.productosEnCarrito=[],this.cartService.actualizarCarrito(this.productosEnCarrito)}eliminarProductoDelCarrito(r){this.carritoService.eliminarProducto(r)}confirmarCompra(){if(this.authService.obtenerUid()){if(this.audio.play(),0===this.productosEnCarrito.length||!this.usuarioActual)return void console.error("No hay productos en el carrito o no hay usuario autenticado");this.firestoreService.obtenerUsuarioPorUID(this.usuarioActual.uid).then(o=>{const e={uid:this.usuarioActual.uid,nombre:o?.nombre||"Usuario",apellido:o?.apellido||"Desconocido",email:this.usuarioActual.email},c=this.calcularSubtotal(),m={id:this.firestoreService.generarId(),usuario:e,productos:this.productosEnCarrito,fecha:new Date,totalprecio:c,fechaEntrega:new Date((new Date).setDate((new Date).getDate()+7))};this.firestoreService.agregarPedido(m).then(()=>{console.log("Pedido guardado con \xe9xito"),this.limpiarCarrito(),d().fire({title:"Compra realizada",text:"Se realiz\xf3 la compra con \xe9xito",imageUrl:"assets/alertaImagen/comprado.jpg",imageWidth:100,imageHeight:100,imageAlt:"Compra exitosa",confirmButtonText:"Aceptar"})}).catch(M=>{console.error("Error al guardar el pedido:",M),d().fire({title:"Error",text:"Algo sali\xf3 mal :(",imageUrl:"assets/alertaImagen/coprafallida.webp",imageWidth:100,imageHeight:100,imageAlt:"Error al realizar la compra",confirmButtonText:"Aceptar"})})})}else d().fire({title:"Inicia sesi\xf3n",text:"Debes iniciar sesi\xf3n para confirmar la compra.",imageUrl:"assets/alertaImagen/noLogeado.jpg",imageWidth:100,imageHeight:100,imageAlt:"Inicio de sesi\xf3n requerido",confirmButtonText:"Ir a Login"}).then(()=>{this.servicioRutas.navigate(["/login"])})}static#t=this.\u0275fac=function(o){return new(o||i)(t.Y36(f.ST),t.Y36(g.z),t.Y36(x.C),t.Y36(g.z),t.Y36(l.F0),t.Y36(b.e))};static#r=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-carrito"]],decls:20,vars:10,consts:[[1,"row"],["class","col-lg-3",4,"ngFor","ngForOf"],[1,"custom-row","justify-content-center"],[1,"col-lg-3"],[1,"card",2,"border","1px solid white"],[1,"card-header"],[1,"card-body"],[1,"card-title"],[1,"custom-card-text"],[1,"btn","btn-light",3,"click"],[1,"card",2,"width","18rem"],[1,"card-img-top",3,"src","alt"],[1,"card-text"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0),t.YNc(1,v,21,23,"div",1),t.qZA(),t._UZ(2,"br")(3,"br")(4,"br")(5,"br"),t.TgZ(6,"div",2)(7,"div",3)(8,"div",4)(9,"h5",5),t._uU(10," Total de la compra"),t.qZA(),t.TgZ(11,"div",6)(12,"h5",7),t._uU(13,"Subtotal"),t.qZA(),t.TgZ(14,"p",8)(15,"b"),t._uU(16),t.ALo(17,"currency"),t.qZA()(),t.TgZ(18,"button",9),t.NdJ("click",function(){return e.confirmarCompra()}),t._uU(19,"Confirmar Compra"),t.qZA()()()()()),2&o&&(t.xp6(1),t.Q6J("ngForOf",e.productosEnCarrito),t.xp6(15),t.Oqu(t.G7q(17,2,t.VKq(8,u,e.calcularTotal()))))},dependencies:[s.sg,s.H9],styles:[".mat-toolbar[_ngcontent-%COMP%]{background-color:var(--primary-color);color:var(--text-color)}button[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff}button[_ngcontent-%COMP%]:hover{background-color:#fff;color:#000}.mat-warn[_ngcontent-%COMP%]{background-color:var(--warn-color);color:var(--text-color)}.mat-card[_ngcontent-%COMP%], .mat-menu[_ngcontent-%COMP%]{background-color:var(--background-color);color:var(--text-color)}.mat-slide-toggle-thumb[_ngcontent-%COMP%]{background-color:var(--primary-color)}.mat-slide-toggle-bar[_ngcontent-%COMP%]{background-color:var(--accent-color)}.col-lg-12[_ngcontent-%COMP%]{justify-content:center;display:flex}.row[_ngcontent-%COMP%]{animation-duration:2.7s;animation-name:_ngcontent-%COMP%_animCart;margin:0;display:flex;flex-wrap:wrap;justify-content:flex-start}.custom-row[_ngcontent-%COMP%]{display:flex;justify-content:center}.custom-card-text[_ngcontent-%COMP%]{color:#0dff0d}.col-lg-3[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}@keyframes _ngcontent-%COMP%_animCart{0%{margin-left:100%;width:100%}to{margin-left:0%;width:100%}}.col[_ngcontent-%COMP%]{flex:0 0 calc(33.333% - 20px);margin:10px;border-radius:6px;overflow:hidden;background:var(--primary-color);box-shadow:0 1px 10px #0003;cursor:default;transition:all .4s ease;display:flex;flex-direction:column}.col[_ngcontent-%COMP%]:hover{box-shadow:5px 5px 20px #0006;transform:translateY(-3%)}.card-image[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:contain;display:block;margin:0 auto;border:none;background-color:var(--background-color)}.mat-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.card[_ngcontent-%COMP%]{color:#fff;background-color:var(--background-image)}@media (min-width: 768px){.mat-card[_ngcontent-%COMP%]{height:350px}}@media (max-width: 768px){.col[_ngcontent-%COMP%]{flex:0 0 calc(50% - 20px);max-width:calc(50% - 20px)}}@media (max-width: 576px){.col[_ngcontent-%COMP%]{flex:0 0 calc(100% - 20px);max-width:calc(100% - 20px)}}"]})}return i})()}];let _=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#r=this.\u0275mod=t.oAB({type:i});static#o=this.\u0275inj=t.cJS({imports:[l.Bz.forChild(P),l.Bz]})}return i})(),y=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#r=this.\u0275mod=t.oAB({type:i});static#o=this.\u0275inj=t.cJS({imports:[s.ez,_,h.ot]})}return i})()}}]);